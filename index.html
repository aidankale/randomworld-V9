<script>
/* SNAP LISTS */
const snapMiles = [1,2,5,10,20,50,100,200,300,500,1000,2000,3000,5000,8000,12000];
const snapKm    = [1,2,5,10,20,50,100,200,300,500,1000,2000,3000,5000,8000,20000];

function getSnaps() {
  return document.querySelector("input[name='unit']:checked").value === "miles"
    ? snapMiles
    : snapKm;
}

function getMax() {
  const snaps = getSnaps();
  return snaps[snaps.length - 1];
}

function valueToSlider(val) {
  return (val / getMax()) * 100;
}

function sliderToSnapped(sliderVal) {
  const max = getMax();
  const raw = (sliderVal / 100) * max;
  const snaps = getSnaps();
  return snaps.reduce((a,b) => Math.abs(b-raw) < Math.abs(a-raw) ? b : a);
}

/* ELEMENTS */
const radiusInput = document.getElementById("radius-input");
const slider = document.getElementById("radius-slider");

/* --- Dragging the slider snaps the VALUE --- */
slider.addEventListener("input", () => {
  const snapped = sliderToSnapped(parseFloat(slider.value));
  radiusInput.value = snapped;
  slider.value = valueToSlider(snapped);
});

/* --- Typing DOES NOT SNAP --- */
radiusInput.addEventListener("input", () => {
  let n = parseInt(radiusInput.value, 10);
  if (isNaN(n)) return;

  n = Math.max(1, Math.min(n, getMax()));  // clamp
  radiusInput.value = n;
  slider.value = valueToSlider(n);
});

/* --- Switching units keeps same numeric value if possible --- */
document.querySelectorAll("input[name='unit']").forEach(r => {
  r.addEventListener("change", () => {
    let n = parseInt(radiusInput.value, 10);
    if (isNaN(n)) n = 1;
    n = Math.min(n, getMax());
    radiusInput.value = n;
    slider.value = valueToSlider(n);
  });
});

/* INITIALIZE */
(function init() {
  let n = parseInt(radiusInput.value, 10);
  if (isNaN(n)) n = 100;
  radiusInput.value = n;
  slider.value = valueToSlider(n);
})();
</script>
